-- MySQL Script generated by MySQL Workbench
-- Wed May 12 14:37:01 2021
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema bookmyshow
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema bookmyshow
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `bookmyshow` DEFAULT CHARACTER SET utf8 ;
USE `bookmyshow` ;

-- -----------------------------------------------------
-- Table `bookmyshow`.`peliculas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bookmyshow`.`peliculas` (
  `pelicula_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `pelicula_nombre` VARCHAR(120) NOT NULL,
  `pelicula_poster` VARCHAR(120) NULL COMMENT 'URL de la imagen del poster',
  `created_at` DATE NULL,
  `updated_at` DATE NULL,
  `deleted_at` DATE NULL,
  PRIMARY KEY (`pelicula_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bookmyshow`.`ciudades`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bookmyshow`.`ciudades` (
  `ciudad_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `ciudad_nombre` VARCHAR(60) NOT NULL,
  `created_at` DATE NULL,
  `updated_at` DATE NULL,
  `deleted_at` DATE NULL,
  PRIMARY KEY (`ciudad_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bookmyshow`.`salas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bookmyshow`.`salas` (
  `sala_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `sala_ciudad` INT UNSIGNED NOT NULL,
  `sala_nombre` VARCHAR(150) NOT NULL,
  `created_at` DATE NULL,
  `updated_at` DATE NULL,
  `deleted_at` DATE NULL,
  PRIMARY KEY (`sala_id`),
  INDEX `fksalaciudad_idx` (`sala_ciudad` ASC) VISIBLE,
  CONSTRAINT `fksalaciudad`
    FOREIGN KEY (`sala_ciudad`)
    REFERENCES `bookmyshow`.`ciudades` (`ciudad_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bookmyshow`.`funciones`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bookmyshow`.`funciones` (
  `funcion_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `funcion_pelicula` INT UNSIGNED NOT NULL,
  `funcion_sala` INT UNSIGNED NOT NULL,
  `funcion_disponibles` INT NOT NULL COMMENT 'Num de lugares disponibles',
  `funcion_fecha` DATE NOT NULL,
  `funcion_hora` TIME NOT NULL,
  `created_at` DATE NULL,
  `updated_at` DATE NULL,
  `deleted_at` DATE NULL,
  PRIMARY KEY (`funcion_id`),
  INDEX `fkfuncionpelicula_idx` (`funcion_pelicula` ASC) VISIBLE,
  INDEX `fkfuncionsala_idx` (`funcion_sala` ASC) VISIBLE,
  CONSTRAINT `fkfuncionpelicula`
    FOREIGN KEY (`funcion_pelicula`)
    REFERENCES `bookmyshow`.`peliculas` (`pelicula_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fkfuncionsala`
    FOREIGN KEY (`funcion_sala`)
    REFERENCES `bookmyshow`.`salas` (`sala_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bookmyshow`.`usuarios`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bookmyshow`.`usuarios` (
  `usuario_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `usuario_nombre` VARCHAR(100) NOT NULL,
  `usuario_correo` VARCHAR(65) NOT NULL,
  `usuario_contrasena` VARCHAR(60) NOT NULL,
  `created_at` DATE NULL,
  `updated_at` DATE NULL,
  `deleted_at` DATE NULL,
  PRIMARY KEY (`usuario_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bookmyshow`.`boletos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bookmyshow`.`boletos` (
  `boleto_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `boleto_usuario` INT UNSIGNED NOT NULL,
  `boleto_funcion` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`boleto_id`),
  INDEX `fkboletofuncion_idx` (`boleto_funcion` ASC) VISIBLE,
  INDEX `fkboletousuario_idx` (`boleto_usuario` ASC) VISIBLE,
  CONSTRAINT `fkboletofuncion`
    FOREIGN KEY (`boleto_funcion`)
    REFERENCES `bookmyshow`.`funciones` (`funcion_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fkboletousuario`
    FOREIGN KEY (`boleto_usuario`)
    REFERENCES `bookmyshow`.`usuarios` (`usuario_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `bookmyshow`.`peliculas`
-- -----------------------------------------------------
START TRANSACTION;
USE `bookmyshow`;
INSERT INTO `bookmyshow`.`peliculas` (`pelicula_id`, `pelicula_nombre`, `pelicula_poster`, `created_at`, `updated_at`, `deleted_at`) VALUES (1, 'Star Wars 1. La amenaza fantasma', 'https://swapi.dev/api/films/1/', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`peliculas` (`pelicula_id`, `pelicula_nombre`, `pelicula_poster`, `created_at`, `updated_at`, `deleted_at`) VALUES (2, 'Star Wars 2. El ataque de los clones', 'https://swapi.dev/api/films/2/', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`peliculas` (`pelicula_id`, `pelicula_nombre`, `pelicula_poster`, `created_at`, `updated_at`, `deleted_at`) VALUES (3, 'Star Wars 3. La revancha de los Sith', 'https://swapi.dev/api/films/3/', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`peliculas` (`pelicula_id`, `pelicula_nombre`, `pelicula_poster`, `created_at`, `updated_at`, `deleted_at`) VALUES (4, 'Star Wars 4. Una nueva esperanza', 'https://swapi.dev/api/films/4/', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`peliculas` (`pelicula_id`, `pelicula_nombre`, `pelicula_poster`, `created_at`, `updated_at`, `deleted_at`) VALUES (5, 'Star Wars 5. El imperio contraataca', 'https://swapi.dev/api/films/5/', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`peliculas` (`pelicula_id`, `pelicula_nombre`, `pelicula_poster`, `created_at`, `updated_at`, `deleted_at`) VALUES (6, 'Star Wars 6. El regreso del Jedi', 'https://swapi.dev/api/films/6/', NULL, NULL, NULL);

COMMIT;


-- -----------------------------------------------------
-- Data for table `bookmyshow`.`ciudades`
-- -----------------------------------------------------
START TRANSACTION;
USE `bookmyshow`;
INSERT INTO `bookmyshow`.`ciudades` (`ciudad_id`, `ciudad_nombre`, `created_at`, `updated_at`, `deleted_at`) VALUES (1, 'Ciudad de México', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`ciudades` (`ciudad_id`, `ciudad_nombre`, `created_at`, `updated_at`, `deleted_at`) VALUES (2, 'Puebla', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`ciudades` (`ciudad_id`, `ciudad_nombre`, `created_at`, `updated_at`, `deleted_at`) VALUES (3, 'San Luis Potosi', NULL, NULL, NULL);

COMMIT;


-- -----------------------------------------------------
-- Data for table `bookmyshow`.`salas`
-- -----------------------------------------------------
START TRANSACTION;
USE `bookmyshow`;
INSERT INTO `bookmyshow`.`salas` (`sala_id`, `sala_ciudad`, `sala_nombre`, `created_at`, `updated_at`, `deleted_at`) VALUES (1, 1, 'Zócalo', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`salas` (`sala_id`, `sala_ciudad`, `sala_nombre`, `created_at`, `updated_at`, `deleted_at`) VALUES (2, 1, 'Santa Fe', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`salas` (`sala_id`, `sala_ciudad`, `sala_nombre`, `created_at`, `updated_at`, `deleted_at`) VALUES (3, 1, 'Polanco Platino', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`salas` (`sala_id`, `sala_ciudad`, `sala_nombre`, `created_at`, `updated_at`, `deleted_at`) VALUES (4, 2, 'Angelopolis VIP', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`salas` (`sala_id`, `sala_ciudad`, `sala_nombre`, `created_at`, `updated_at`, `deleted_at`) VALUES (5, 2, 'Galerias', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`salas` (`sala_id`, `sala_ciudad`, `sala_nombre`, `created_at`, `updated_at`, `deleted_at`) VALUES (6, 3, 'El dorado', NULL, NULL, NULL);

COMMIT;


-- -----------------------------------------------------
-- Data for table `bookmyshow`.`funciones`
-- -----------------------------------------------------
START TRANSACTION;
USE `bookmyshow`;
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (1, 1, 1, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (2, 1, 5, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (3, 1, 6, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (4, 2, 1, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (5, 2, 2, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (6, 2, 4, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (7, 3, 2, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (8, 3, 6, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (9, 4, 1, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (10, 4, 4, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (11, 4, 5, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (12, 4, 6, 2, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (13, 4, 2, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (14, 5, 1, 100, '2021-05-10', '17:00', NULL, NULL, NULL);
INSERT INTO `bookmyshow`.`funciones` (`funcion_id`, `funcion_pelicula`, `funcion_sala`, `funcion_disponibles`, `funcion_fecha`, `funcion_hora`, `created_at`, `updated_at`, `deleted_at`) VALUES (15, 6, 1, 100, '2021-05-10', '17:00', NULL, NULL, NULL);

COMMIT;


-- -----------------------------------------------------
-- Data for table `bookmyshow`.`usuarios`
-- -----------------------------------------------------
START TRANSACTION;
USE `bookmyshow`;
INSERT INTO `bookmyshow`.`usuarios` (`usuario_id`, `usuario_nombre`, `usuario_correo`, `usuario_contrasena`, `created_at`, `updated_at`, `deleted_at`) VALUES (1, 'usuario1', 'usuario1@example.com', 'contrasena', NULL, NULL, NULL);

COMMIT;



create view view_funciones AS

SELECT 
  funcion_id, funcion_disponibles, funcion_fecha, funcion_hora,
  pelicula_id, pelicula_nombre, pelicula_poster, 
  sala_id,  sala_nombre, 
  ciudad_id, ciudad_nombre
FROM funciones 
INNER JOIN peliculas ON funcion_pelicula = pelicula_id
INNER JOIN salas ON funcion_sala = sala_id
INNER JOIN ciudades ON sala_ciudad = ciudad_id





